# 番茄自习室项目汇报

## 📊 项目概况

 **项目名称** ：Studyroom 共享自习室（番茄钟协作学习平台）
 **技术栈** ：Spring Boot 3.5.9 + React 19 + WebSocket + H2数据库
 **项目类型** ：全栈Web应用（前后端分离架构）
 **开发时间** ：2026年1月（至今）

---

## 一、当前项目进展（完成度分析）

### 1.1 后端开发进度 ✅ **已完成约70%**

#### ✅ 已实现功能模块

 **核心实体层** （Entity & Repository）

* Room - 房间实体（包含标题、科目、描述）
* User - 用户实体（用户名、密码、金币、总学习时长）
* Pomodoro - 番茄钟记录（房间ID、用户ID、时长、结果、奖励金币）
* CoinTransaction - 金币交易记录（可追溯性）
* 基于JPA的数据持久化，使用H2文件数据库

 **业务服务层** （Service）

* RoomService - 房间CRUD操作
* PomodoroService - 番茄钟记录创建、金币发放逻辑、番茄钟列表查询
* 实现了事务性金币奖励机制：SUCCESS完成奖励5金币

 **REST API层** （Controller）

* AuthController - 用户注册/登录/个人信息查询
* RoomController - 房间列表、详情、创建、更新、删除
* RoomActivityController - 番茄钟记录和金币查询接口

 **实时通信层** （WebSocket）

* RoomWebSocketHandler - 处理WS消息（join/leave/chat/timerStatus）
* RoomRealtimeService - 房间成员状态管理、消息广播
* 支持多房间并发、成员状态同步（专注中/休息中/离开）

**基础设施**

* CorsConfig - 跨域配置
* DataInitializer - 数据初始化
* 异常处理机制、数据验证

#### ⚠️ 待完成/改进

* 密码加密存储（当前为明文存储，仅适用于原型演示）
* JWT或Session管理的身份验证机制
* 房间容量限制和人数统计
* 问答系统（金币扣除/奖励机制）
* 用户学习统计数据聚合API
* 单元测试覆盖率不足

---

### 1.2 前端开发进度 ✅ **已完成约65%**

#### ✅ 已实现页面

**用户认证**

* LoginPage - 登录界面（含精美背景、图标、表单验证）
* RegisterPage - 注册界面（实时验证、密码确认）


**房间管理**

* RoomsPage - 房间列表（卡片式展示、随机图片、状态标签）
* CreateRoomPage - 创建房间表单
* RoomDetailPage - 房间详情页（ **核心页面** ，约756行代码）
  * 圆桌式成员展示（虚拟形象排列）
  * WebSocket实时聊天功能
  * 番茄钟计时器集成
  * 成员状态同步（专注/休息/离开）
  * 学习任务管理（Task功能）

**个人中心**

* PersonalCenterPage - 个人中心（用户信息、金币展示、学习数据可视化图表）

**公共组件**

* MainLayout - 主布局框架（顶部导航栏）
* PomodoroTimer - 番茄钟计时器组件（可配置时长、事件回调）

**网络层**

* [http.js](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) - Axios封装的HTTP客户端
* [rooms.js](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) - 房间相关API
* [system.js](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) - 系统API（登录注册）

#### ⚠️ 待完成/改进

* 个人中心的学习统计数据对接后端API（当前使用Mock数据）
* 植物系统和虚拟形象系统（仅UI框架）
* 房间背景自定义功能
* 问答功能界面
* 通知系统（桌面通知）
* 响应式设计优化（移动端适配）

---

### 1.3 DevOps与部署 🟡 **基础完成**

* [Dockerfile](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 已配置
* H2数据库文件持久化配置
* 支持dev/prod环境配置切换
* 前端Vite构建配置
* ⚠️ 缺少CI/CD流水线
* ⚠️ 缺少生产环境部署文档

---

## 二、已解决的关键问题及解决思路

### 2.1 问题1：WebSocket多房间并发管理

 **问题描述** ：
需要支持多个房间同时在线，每个房间有独立的成员列表、聊天消息和状态同步。

 **解决思路** ：

1. 在 [RoomRealtimeService.java**:17-21**](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 中使用三层ConcurrentHashMap：
   * [membersByRoom](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：按房间ID存储成员状态
   * [sessionsByRoom](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：按房间ID存储WebSocket会话
   * [sessionStateBySessionId](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：按会话ID存储用户状态
2. 实现原子化的join/leave操作，支持断线重连和多客户端登录
3. 通过 [broadcastToRoom](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 方法实现房间级别的消息广播

 **效果** ：成功实现房间隔离、成员状态实时同步

---

### 2.2 问题2：番茄钟完成后的金币发放事务一致性

 **问题描述** ：
用户完成番茄钟后需要同时记录学习时长、番茄钟记录、金币交易和更新用户金币余额，需要保证事务一致性。

 **解决思路** ：

1. 在 [PomodoroService.java**:38**](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 方法上添加 [@Transactional](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 注解
2. 在同一事务内依次执行：
   * 验证房间和用户存在
   * 更新用户总学习时长
   * 创建番茄钟记录
   * 如果结果为SUCCESS，创建金币交易记录并更新用户金币
3. 使用 [CoinTransactionRepository.sumByRoomId](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 支持金币累计查询

 **效果** ：确保数据一致性，避免金币发放失败但番茄钟已记录的问题

---

### 2.3 问题3：前端WebSocket断线重连

 **问题描述** ：
网络不稳定时WebSocket连接断开，导致用户失去实时通信能力。

 **解决思路** ：

1. 在 [RoomDetailPage.jsx**:170**](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 中监听 [ws.onclose](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 和 [ws.onerror](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 事件
2. 实现自动重连机制（基于useEffect依赖项）
3. 保存用户ID到localStorage，重连后自动恢复身份
4. 通过 `joined` 消息确认服务端分配的有效userId

 **效果** ：提升用户体验，减少掉线后的操作损失

---

### 2.4 问题4：H2数据库文件锁冲突

 **问题描述** ：
在开发调试时，H2控制台和Spring Boot应用同时访问数据库文件导致"文件被锁"错误。

 **解决思路** ：
在 [application.yaml**:15**](vscode-file://vscode-app/c:/Users/%E5%90%B4%E4%BC%9F%E5%81%A5/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 的JDBC URL中添加 `AUTO_SERVER=TRUE` 参数：

* []()
* []()
* []()
* []()

 **效果** ：允许多进程同时访问数据库，避免开发时频繁重启

---

### 2.5 问题5：前端跨域请求失败

 **问题描述** ：
React前端（5173端口）访问Spring Boot后端（8080端口）时触发CORS错误。

 **解决思路** ：
在 CorsConfig 中配置全局CORS过滤器，允许来自前端开发服务器的请求。

 **效果** ：前后端联调顺畅

---

## 三、接下来的目标与待解决问题

### 3.1 高优先级目标（下周必须完成）

#### 目标1：个人中心数据对接

* **问题** ：当前个人中心使用Mock数据，无法展示真实学习统计
* **任务** ：
* 后端开发用户学习统计API（按日/周/月聚合番茄钟数据）
* 前端对接API替换Mock数据
* 实现金币获取记录列表查询
* **验收标准** ：个人中心能展示用户真实的学习时长、金币记录、番茄钟完成数

#### 目标2：安全性加固

* **问题** ：密码明文存储、无身份验证机制
* **任务** ：
* 使用BCrypt加密密码
* 实现JWT Token认证
* 前端添加Token拦截器，未登录自动跳转
* **验收标准** ：无法通过H2控制台直接看到明文密码，API调用需要携带Token

#### 目标3：房间容量控制



* **问题** ：房间无人数限制，前端显示的"0/20"为假数据
* **任务** ：
* Room实体添加 `maxCapacity` 字段
* WebSocket加入房间时检查容量，满员拒绝加入
* 前端显示真实在线人数
* **验收标准** ：房间满员时新用户无法加入，显示提示信息

---

### 3.2 中等优先级目标

#### 目标4：问答系统（金币消耗场景）

* 提问扣除金币、回答获得金币
* 问题列表和答案管理

#### 目标5：植物系统

* 金币购买植物种子
* 植物成长可视化

#### 目标6：单元测试和集成测试

* 服务层测试覆盖率达到80%
* API端到端测试

---

### 3.3 当前阻塞性问题

 **问题1：后端启动失败** （Exit Code: 1）

* **现象** ：Terminal显示"Run: StudyroomApplication"执行失败
* **可能原因** ：
* 端口8080被占用
* Lombok注解处理器配置问题
* 数据库初始化失败
* **下周行动** ：优先排查日志，修复启动问题

**问题2：前端构建警告**

* **现象** ：esbuild terminal显示Exit Code: 1
* **影响** ：可能影响生产构建
* **下周行动** ：检查ESLint配置和依赖版本兼容性

---

## 四、下周工作计划（2026年1月20日-1月24日）

### 周一（1/20）- 问题排查日

* [ ] 修复后端启动失败问题（排查日志，解决端口冲突或配置错误）
* [ ] 修复前端构建警告
* [ ] 完成现有功能的回归测试，确保核心流程可演示

### 周二（1/21）- 安全性开发日

* [ ] 后端：集成Spring Security + JWT
* [ ] 后端：密码BCrypt加密迁移（需要数据库迁移脚本）
* [ ] 前端：实现Token存储和请求拦截器

### 周三（1/22）- 统计功能开发日

* [ ] 后端：开发学习统计API（聚合查询番茄钟数据）
* [ ] 后端：开发金币交易记录查询API
* [ ] 前端：对接个人中心统计数据

### 周四（1/23）- 房间功能完善日

* [ ] 后端：房间容量控制逻辑
* [ ] 前端：实时显示在线人数
* [ ] WebSocket：房间满员提示消息
* [ ] 编写单元测试（RoomService、PomodoroService）

### 周五（1/24）- 测试与文档日

* [ ] 端到端测试（登录→创建房间→加入→完成番茄钟→查看统计）
* [ ] 更新README.md（添加环境配置、启动步骤、API文档）
* [ ] 准备演示PPT和演示脚本
* [ ] 代码Review和重构优化

---

## 五、技术债务与风险

### 技术债务

1. **测试覆盖率低** ：仅有一个空的ApplicationTests
2. **异常处理不统一** ：缺少全局异常处理器
3. **日志记录不完善** ：缺少关键业务操作日志
4. **前端状态管理混乱** ：大量useState，建议引入Redux或Zustand

### 风险项

1. **数据库迁移** ：从H2迁移到MySQL时可能有兼容性问题
2. **WebSocket扩展性** ：当前内存管理状态，无法支持多实例部署（需要Redis）
3. **性能瓶颈** ：未进行压力测试，不确定并发承载能力

---

## 六、项目亮点与可演示功能

✨  **当前可完整演示的功能链路** ：

1. 用户注册/登录（含表单验证、UI精美）
2. 创建房间→查看房间列表
3. 进入房间详情页
4. WebSocket实时聊天
5. 启动番茄钟计时
6. 完成番茄钟后金币自动发放
7. 查看个人中心金币余额

🎯  **技术亮点** ：

* 前后端分离架构清晰
* WebSocket实时通信稳定
* 事务性金币系统设计合理
* UI设计美观（Ant Design组件库）
* 支持Docker容器化部署

---

## 七、总结

项目整体进度良好，核心功能已基本实现，当前完成度约为 **68%** 。下周的关键任务是修复启动问题、加固安全性、对接统计数据，确保演示时能够展示完整的用户旅程。建议团队成员分工明确，前端专注UI完善和数据对接，后端专注安全和测试，共同攻克技术债务，为项目验收做好准备。

 **项目状态** ：🟢 健康（On Track）
 **风险等级** ：🟡 中等（需关注启动问题和安全性）
 **推荐行动** ：按计划推进，优先解决阻塞性问题
